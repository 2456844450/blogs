# 使用 Docker 构建一个容器应用

Docker 是一个可以将应用容器化的工具，可以简单的把容器理解为一个和羽毛一样轻的虚拟机，和传统的虚拟机不同，它并不会给系统带来太大的负担，并且有更高的可移植性和扩展性。在容器中应用将享有独立的文件系统，容器内的操作将不会影响到自身的主机系统，有点类似于三体中的小宇宙空间，在里面可以有高度的自由操作空间，并且已经预设了你喜欢的装修风格（应用运行所需的环境）！

我们将使用 Docker 来搭建一个最简单的 Node 容器化应用，这个镜像将会被我们打包，上传到自己的 Docker 仓库，并且可以开箱即用。想象这么一个场景，你的开发机器将这个应用进行容器化以后，在自己的服务器上将这个容器化的镜像下载后，使用一个命令就可以使你的应用在另一个完全不同的环境运行起来，节约下来的这些时间可以让我们做更多自己喜欢的事情，而不是钻研一个我们可能搞不定的 “Linux 环境问题”！

## 第一步：下载并安装 Docker

[下载地址](https://hub.docker.com/?overlay=onboarding)，希望这一步没有难倒你。

## 第二步：编写一个简单的 Node 应用

为了保持足够简单，我使用了 `Express`，它只有一个功能，在主页输出一个 `Hello Docker`，如果你对此有疑惑，可以参考[源码仓库]()，也可以参考下面的代码：

```js
const express = require('express');

const app = express();

app.get("/", (req, res) => {
  res.end("Hello Docker!")
});

app.listen(8000, () => {
  console.log("server is starting in http://localhost:8000");
});
```

保险起见，我们最好使用 `node app.js` 测试一下这个应用是健康的，启动后浏览器打开 `http://localhost:8000`，我们可以顺利看到 Hello Docker! 被输出在屏幕上，看来一切在朝着我们期望的方向发展着。

## 第三步：将 Node 应用装箱打包成镜像

这一步可能会接触到你的知识盲区了，所以我们用一个比较简单轻松的风格来剖析每一步需要做的事情，将复杂的事情分解成多个简单的步骤，这是我们解决复杂问题的一贯方式。

我们在应用的同级目录下新建一个 `Dockerfile` 文件，让这个记录员帮我们记录我们接下来要做的事情。你的目录应该看起来跟我的基本一致：

![目录结构](http://shadows-mall.oss-cn-shenzhen.aliyuncs.com/images/blogs/other/Jietu20191126-183738@2x.png)

### 我们的应用需要什么？

我们第一个需要思考的问题是，我们的应用需要什么，我们可能知道，它需要一台计算机来运行，这个倒是不用担心，Docker 也需要计算机，它能有的我们都可以有。那我们的应用还需要什么呢，众所周知，Docker 是用 Go 语言实现的，那他会有 Node 的运行环境吗？

不，它没有，所以我们第一步是构建一个支持 Node 应用运行的环境，那我们就需要先在这个容器中放进去一个 Node，怎么放进去呢，一个简单的命令就可以了，在 `Dockerfile` 中新增一行：

```dockerfile
# 这句命令的作用是让我们的镜像在 node:10.16.3 镜像的基础上开始
# 站在巨人的肩膀上
FROM node:10.16.3
```

### 我们需要在容器里做什么？

我们的记录员 `Dockerfile` 已经帮我们记录了第一步要做的事情，我们可以在第一步的基础上思考第二步要做的事情了。

在前面我们提到过，在容器中有一个自己的小宇宙，这个小宇宙虽然我们不常来，但是我们也应该希望它能够和大宇宙一样井井有条，所以呢，我们要在这个容器单独的文件系统中指定一个工作目录，以便我们将来能够在容器中尽快找到我们的应用，所以让我们的记录员加上一句：

```dockerfile
# 这句命令的作用是指定应用在容器中的工作目录
# 为我们的应用找到了一个干净的房间，它将在这里开始它的一生
WORKDIR /usr/src/app
```

