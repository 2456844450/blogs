# 程序的机器级表示

计算机执行机器代码，用字节序列编码低级的操作，包括处理数据、管理内存、读写存储设备上，以及利用网络通信。编译器基于编译语言的规则、目标机器的指令集和操作系统遵循的惯例，经过一系列的阶段生成机器代码。

GCC C语言编译器以汇编代码的形式产出输出，汇编代码是机器代码的文本显示，给出程序中的每一条指令。然后 GCC 调用汇编器和链接器，根据汇编代码生成可执行的机器代码。

当我们使用高级语言编程的时候，机器屏蔽了程序的细节，即机器级的实现。能够阅读和理解汇编代码对于程序来说是一项很重要的技能，通过阅读这些汇编代码，我们能够理解汇编器的优化能力，并分析代码中隐含的低效率。

## 历史观点

Intel 处理器系列简称 x86，每个后继处理器的设计都是后向兼容的 —— 较早版本上编译的代码可以在较新的处理器上运行。

> 摩尔定律 —— 芯片上的晶体每年都会翻一番。（见下图）

![image](http://shadows-mall.oss-cn-shenzhen.aliyuncs.com/images/assets/cs/28.png)

## 程序编码

考虑以下编译过程（如下图）

![image](http://shadows-mall.oss-cn-shenzhen.aliyuncs.com/images/assets/cs/29.png)

在上图中，gcc （GCC C 编译器）命令调用了一整套的程序，将源代码转为可执行代码。
  - 首先，C 预处理器扩展源代码，插入所有用 #include 命令指定的文件，并扩展所有用 #define 声明指定的宏。
  - 其次，编译器产生两个源文件的汇编代码，名字分别为 p1.s 和 p2.s。
  - 接下来，汇编器会将汇编代码转化为二进制目标代码文件 p1.o 和 p2.o。目标代码是机器代码的一种形式，它包含所有指令的二进制表示，但是还没有填入全局值的地址。
  - 最后，链接器将两个目标代码文件与实现库函数（例如 printf）的代码合并，并产生最终的可执行代码文件 p。（由命令指示符 -o p 指定的）。可执行代码是我们要考虑的机器代码的第二种形式，也就是处理器执行的代码格式。

### 机器级代码

计算机系统使用了多种不同形式的抽象，对于机器级编程来说，其中两种抽象尤为重要：

  1. 由 `指令集体系结构或指令集架构（Instruction Set Architecture, ISA）` 来定义机器级程序的格式和行为，它定义了处理器状态、指令的格式，以及每条指令对状态的影响。
  2. 机器级程序使用的内存地址是虚拟地址，提供的内存模型看上去是一个非常大的字节数组。

150.