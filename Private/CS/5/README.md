# 优化程序性能

编写高效程序需要做到以下几点：

1. 我们必须选择一组适当的算法和数据结构。
2. 我们必须编写出编译器能够有效优化以转换成高效可执行代码的源代码。

## 优化编译器的能力和局限性

现代编译器运用复杂精细的算法来确定一个程序中计算的是什么值，以及它们是被如何使用的。然后会利用一些机会来简化表达式，在几个不同的地方使用同一个计算，以及降低一个给定的计算必须执行的次数。大多数编译器，包括 GCC 是可以指定优化等级的，以选项 `-Og` 调用 GCC 是让 GCC 使用一组基本的优化。以选项 “-O1” 或更高（如 `-O2、-O3`）调用 GCC 会让它使用更大量的优化。

下面是一个案例（如下图）

![image](http://shadows-mall.oss-cn-shenzhen.aliyuncs.com/images/assets/cs/146.png)

![image](http://shadows-mall.oss-cn-shenzhen.aliyuncs.com/images/assets/cs/147.png)

GCC 只能完成基本的优化，因此，使用 GCC 的程序员必须花费更多的精力，以一种简化编译器生成高效代码的任务的方式来编写程序。



## 表示程序性能

我们引入度量标准每元素的周期数（Cycles Per Element，CPE），作为一种表示程序性能，并且指导我们改进代码的方法。

处理器活动的顺序是由时钟控制的，时钟提供了某个频率的规律信号，通常用千兆赫兹（GHz)，即十亿周期每秒来表示。例如，当一个系统有 “4GHz” 处理器，这表示处理器时钟运行频率为每秒 4 * 10^9 个周期。每个时钟周期的时间是时钟频率的倒数。通常是以纳秒（1 纳秒等于 10^-9 秒）或皮秒（1 皮秒等于 10^-12 秒）为单位的。例如，一个 4GHz 的时钟周期为 0.25 纳秒，或者 250 皮秒。

下面是一个示例：

![image](http://shadows-mall.oss-cn-shenzhen.aliyuncs.com/images/assets/cs/148.png)


## 程序示例

